
# Техническое задание: MyDiary — приложение «Дневник настроения» (WPF)

**Студент:** [Ливитчук Степан Александрович]

**Группа:** [2307в2]

**Дисциплина:** [Разработка программных модулей]

**Версия документа:** 1.0

**Дата:** [13.10.25]

---

## 1. Описание проекта

### 1.1 Название системы
MyDiary — приложение «Дневник настроения».

### 1.2 Назначение
Приложение предназначено для ведения личного дневника настроения: пользователь может создавать записи за конкретные даты, отмечать настроение и активности, просматривать записи и статистику. Доступ к функционалу регулируется системой подписки с несколькими тарифными планами.

### 1.3 Целевая аудитория
- Пользователи, которые хотят отслеживать настроение и привычки.
- Пользователи, которым важна простая и понятная статистика по самочувствию.

### 1.4 Термины и определения
- **Запись** — запись дневника за дату с заголовком, описанием, уровнем настроения и набором активностей.
- **Уровень настроения** — числовое значение 1..5 (в UI может отображаться эмодзи).
- **Активность** — тег/категория (например: «спорт», «работа», «сон»), который пользователь может привязать к записи.
- **Подписка** — временный доступ к полной функциональности приложения.

---

## 2. Функциональные требования

Ниже описаны основные функции системы. Формулировки содержат:
- что делает функция
- какие данные вводит пользователь
- какой результат ожидается

### 2.1 Регистрация пользователя
- **Описание:**
  - Пользователь создаёт аккаунт в системе.
  - Вводит логин, пароль и (опционально) имя/отображаемое имя.
  - Пароль скрыт; пользователь может включить/выключить «показать пароль».
  - Система проверяет корректность ввода (минимальная длина, обязательные поля, уникальность логина — в будущей версии с БД).
- **Входные данные:**
  - Логин
  - Пароль
  - Подтверждение пароля (если предусмотрено)
- **Результат:**
  - Аккаунт создан.
  - Пользователь перенаправляется на экран входа или сразу в приложение (вариант определяется архитектурой).

### 2.2 Вход в систему
- **Описание:**
  - Пользователь вводит логин и пароль.
  - Пароль скрыт; есть переключатель «показать пароль».
  - При успешном входе пользователь попадает в приложение.
  - Если подписки нет или она неактивна — пользователь перенаправляется на экран подписки.
- **Входные данные:**
  - Логин
  - Пароль
- **Результат:**
  - Успешный вход: открывается главный экран (записи).
  - Неуспешный вход: отображается сообщение об ошибке.

### 2.3 Система подписки (выбор тарифа)
- **Описание:**
  - На экране подписки пользователь выбирает один из тарифных планов.
  - Тарифы:
    - **Месяц:** 320 ₽
    - **6 месяцев:** 1728 ₽
    - **Год:** 3072 ₽
  - Выбор должен быть выполнен «плитками» (ToggleButton), всегда выбран ровно один тариф.
  - По кнопке «Перейти к оплате» пользователь переходит на экран оплаты, выбранный тариф передаётся параметром навигации.
- **Входные данные:**
  - Выбранный тариф (месяц / 6 месяцев / год)
- **Результат:**
  - Переход на экран оплаты с отображением суммы выбранного плана.

### 2.4 Оплата подписки (обязательная функция для курсовой)
- **Описание:**
  - Пользователь видит выбранный тариф и сумму к оплате.
  - Вводит email для чека.
  - Вводит данные карты:
    - номер карты (только цифры)
    - срок действия (MM / YY, только цифры, автопереход фокуса)
    - CVC (только цифры)
  - В текущей реализации оплату можно сделать «моковой» (заглушка): по нажатию «Оплатить» происходит навигация и (в будущей версии) будет создаваться запись о подписке.
- **Входные данные:**
  - Email
  - Номер карты
  - MM / YY
  - CVC
- **Результат:**
  - (Будущая версия) Создан платеж/подписка, доступ активирован.
  - (Текущая версия) Навигация на основной экран как заглушка.

### 2.5 Создание записи дневника (настроения)
- **Описание:**
  - Пользователь создаёт запись дневника:
    - заголовок
    - настроение (1..5)
    - активности (можно выбрать несколько)
    - подробное описание
  - После сохранения запись появляется в списке записей и влияет на календарь/статистику.
- **Входные данные:**
  - Заголовок
  - Уровень настроения
  - Набор активностей
  - Текст записи
- **Результат:**
  - Запись создана и отображается в списке.

### 2.6 Просмотр и изменение записи дневника
- **Описание:**
  - Пользователь может открыть запись из списка и просмотреть детали.
  - В будущей версии пользователь может редактировать запись (update) и удалять её (delete).
- **Входные данные:**
  - Выбор записи из списка
- **Результат:**
  - Открыта форма просмотра.
  - (Будущая версия) Изменения сохранены в БД.

### 2.7 Просмотр статистики
- **Описание:**
  - Пользователь открывает экран статистики.
  - Отображается:
    - график (линейный)
    - краткая сводка по месяцу (текстовая)
    - распределение эмоций/настроений
  - В будущей версии статистика строится по реальным данным в БД.
- **Входные данные:**
  - Выбор периода (минимум: текущий месяц)
- **Результат:**
  - Показаны показатели по настроению за период.

### 2.8 Настройки приложения
- **Описание:**
  - Пользователь может изменить язык интерфейса (через конвертеры).
  - Пользователь может управлять списком активностей (добавить свои активности).
  - Пользователь может выйти из аккаунта.
- **Входные данные:**
  - Выбор языка
  - Название новой активности
  - Команда выхода
- **Результат:**
  - Настройки применены.
  - При выходе — переход на экран входа.

---

## 3. Структура базы данных

Раздел описывает рекомендуемую структуру БД для будущей реализации. На этапе UI данные могут быть моковыми.

### Таблица 1: Users (Пользователи)
**Описание:** хранит учетные записи пользователей.

**Поля:**
- `Id` (Guid, PK) — уникальный идентификатор
- `Login` (string) — логин (уникальный)
- `DisplayName` (string) — отображаемое имя
- `PasswordHash` (string) — хеш пароля
- `CreatedAtUtc` (DateTime) — дата регистрации

**Связи:**
- 1:N с `DiaryEntries`
- 1:N с `Subscriptions`

**Индексы:**
- уникальный индекс по `Login`

### Таблица 2: DiaryEntries (Записи дневника)
**Описание:** хранит записи пользователя.

**Поля:**
- `Id` (Guid, PK)
- `UserId` (Guid, FK → Users.Id)
- `EntryDate` (DateOnly/DateTime) — дата, к которой относится запись
- `Title` (string)
- `Content` (string)
- `MoodLevel` (int) — 1..5
- `CreatedAtUtc` (DateTime)
- `UpdatedAtUtc` (DateTime?) *(nullable)*

**Связи:**
- `UserId` → Users.Id
- N:M с `Activities` (через таблицу `EntryActivities`) — рекомендовано

**Индексы:**
- индекс по `(UserId, EntryDate)`

### Таблица 3: Subscriptions (Подписки)
**Описание:** хранит подписки пользователей.

**Поля:**
- `Id` (Guid, PK)
- `UserId` (Guid, FK → Users.Id)
- `Plan` (int/enum) — Month / HalfYear / Year
- `PriceRub` (int)
- `StartsAtUtc` (DateTime)
- `EndsAtUtc` (DateTime)
- `Status` (int/enum) — Active/Expired/Cancelled

**Связи:**
- `UserId` → Users.Id

### Таблица 4: Activities (Активности) *(планируется)*
**Описание:** хранит список активностей.

**Поля:**
- `Id` (Guid, PK)
- `UserId` (Guid?) *(nullable)* — null для системных активностей, не null для пользовательских
- `Title` (string)

### Таблица 5: EntryActivities (Запись–Активность) *(планируется)*
**Описание:** связующая таблица многие-ко-многим.

**Поля:**
- `EntryId` (Guid, PK/FK → DiaryEntries.Id)
- `ActivityId` (Guid, PK/FK → Activities.Id)

**Альтернатива (упрощенная):**
- хранить активности строкой `ActivitiesJson` в `DiaryEntries`.
- **Плюсы:** быстрее реализовать.
- **Минусы:** хуже фильтрация и аналитика.

---

## 4. Основные формы приложения (WPF UserControls)

Архитектура UI:
- Главное окно: `MainWindow` (контейнер + TopBar)
- Контент отображается в `MainContent` через навигацию (AppPage)

### Форма 1: MainWindow
**Назначение:** корневое окно приложения, содержит TopBar и область контента.

**Элементы управления:**
- `ContentControl MainContent` — загрузка активного экрана
- TopBar — кнопки перехода по основным разделам

**Действия:**
- Навигация по страницам приложения

### Форма 2: LoginView
**Назначение:** вход в систему.

**Элементы управления:**
- TextBox (логин)
- PasswordBox/TextBox (пароль + переключатель видимости)
- CheckBox «Запомнить меня» (планируется логика)

**Действия:**
- «Войти» → проверка данных → переход на Subscription/Entries
- «Регистрация» → переход на RegisterView

### Форма 3: RegisterView
**Назначение:** регистрация.

**Элементы управления:**
- поля логина и пароля
- переключатель видимости пароля

**Действия:**
- «Создать аккаунт» → регистрация → переход на LoginView

### Форма 4: SubscriptionView
**Назначение:** выбор тарифа подписки.

**Элементы управления:**
- ToggleButton-плитки тарифов

**Действия:**
- «Перейти к оплате» → PaymentView (с параметром выбранного плана)
- «Назад» → LoginView

### Форма 5: PaymentView
**Назначение:** ввод данных оплаты подписки.

**Элементы управления:**
- отображение тарифа и суммы
- email для чека
- поля карты (номер, MM/YY, CVC)

**Действия:**
- «Оплатить» → (заглушка) переход в Entries
- «Назад» → SubscriptionView

### Форма 6: EntriesView
**Назначение:** список записей + календарь настроения.

**Элементы управления:**
- список записей
- календарь (индикация настроения)

**Действия:**
- открыть запись → EntryDetailsView
- создать запись → AddEntryView

### Форма 7: AddEntryView
**Назначение:** создание записи дневника.

**Элементы управления:**
- заголовок
- выбор эмоции/настроения
- выбор активностей
- описание

**Действия:**
- «Применить» → сохранить запись → возврат на EntriesView
- «Назад» → EntriesView

### Форма 8: EntryDetailsView
**Назначение:** просмотр записи.

**Действия (план):**
- «Редактировать» → AddEntryView в режиме редактирования
- «Удалить» → подтверждение → удаление

### Форма 9: StatisticsView
**Назначение:** график и сводка по настроению.

**Элементы управления:**
- график
- блоки статистики

### Форма 10: SettingsView
**Назначение:** настройки языка, активности, выход.

**Действия:**
- смена языка
- добавление/удаление пользовательских активностей
- «Выйти» → LoginView

---

## 5. Схема переходов между формами

### 5.1 Навигация при запуске
1. **Запуск приложения** → `LoginView`
2. **LoginView**:
   - Успешный вход и есть подписка → `EntriesView`
   - Успешный вход и нет подписки → `SubscriptionView`
   - «Регистрация» → `RegisterView`
3. **RegisterView** → после успешной регистрации → `LoginView`

### 5.2 Подписка и оплата
1. `SubscriptionView` → «Перейти к оплате» → `PaymentView` (передаётся выбранный план)
2. `PaymentView`:
   - «Оплатить» → (заглушка) `EntriesView`
   - «Назад» → `SubscriptionView`

### 5.3 Основной цикл работы
1. `EntriesView`:
   - «Создать запись» → `AddEntryView`
   - выбор записи → `EntryDetailsView`
2. `AddEntryView`:
   - «Применить» → `EntriesView`
   - «Назад» → `EntriesView`
3. `EntryDetailsView`:
   - «Назад» → `EntriesView`

### 5.4 Дополнительные разделы
1. `TopBar` → `StatisticsView`
2. `TopBar` → `SettingsView`
3. `SettingsView` → «Выйти» → `LoginView`

---

## 6. Нефункциональные требования

### 6.1 Технологический стек
- Язык: C#
- Платформа: .NET (целевой: net8.0-windows)
- UI: WPF
- Доступ к данным (план): Entity Framework Core + SQL Server LocalDB/SQL Server/SQLite

### 6.2 Требования к качеству кода
- Код должен собираться без ошибок.
- Соблюдать базовые конвенции C#.
- Избегать чрезмерной когнитивной сложности (разбивать на методы/классы).

### 6.3 Безопасность
- Пароль хранить только в виде хеша (в будущей версии при подключении БД).
- Не хранить CVV/данные карты в БД (оплата может быть моковой).

### 6.4 Производительность
- Выборка записей по месяцу должна выполняться быстро (индекс `(UserId, EntryDate)`).
- UI не должен зависать при загрузке больших объёмов данных (в будущем — async).

---

## 7. Планируемые улучшения (будущие функции)

- Реальная БД и миграции EF Core.
- Реальная логика подписки (активна/не активна) и автопереход Login → Entries/Subscription.
- CRUD для активностей (добавление, редактирование, удаление).
- Редактирование/удаление записей.
- Улучшенная статистика: тренды, фильтры по активностям, экспорт.
- Режим автологина/выхода (локальная сессия в файле/DPAPI).

---

## 8. Критерии приемки (Acceptance Criteria)

### 8.1 Авторизация
- Пользователь может перейти на регистрацию и создать аккаунт.
- Пользователь может войти по логину/паролю.
- При неверных данных отображается ошибка.

### 8.2 Подписка и оплата
- На SubscriptionView доступны 3 тарифа.
- Выбран всегда ровно 1 тариф.
- При переходе на PaymentView отображается цена выбранного тарифа.
- В PaymentView поля карты принимают только цифры.

### 8.3 Записи
- Пользователь может открыть форму создания записи.
- После сохранения запись отображается в списке.

### 8.4 Статистика
- Открывается экран статистики и отображается график/сводка (минимум заглушка).

### 8.5 Настройки
- Можно сменить язык интерфейса (через конвертеры).
- Можно выйти из аккаунта.

