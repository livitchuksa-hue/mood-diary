# Техническое задание: MyDiary — приложение «Дневник настроения» (WPF)

**Студент:** [Ливитчук Степан Александрович]
**Группа:** [2307в2]
**Дисциплина:** [Разработка программных модулей]
**Версия документа:** 2.0
**Дата:** [20.12.25]

---

## 1. Описание проекта

### 1.1 Название системы
MyDiary — приложение «Дневник настроения».

### 1.2 Назначение
Приложение предназначено для ведения личного дневника настроения: пользователь может создавать записи за конкретные даты, задавать уровень настроения, связывать с активностями, просматривать историю и статистику. Функциональность регулируется системой подписки (несколько тарифов, оплата картой; автопродления с сохранённым способом оплаты).

### 1.3 Целевая аудитория
- Пользователи, желающие создавать дневник самооценки.
- Пользователи, которым интересен личностный трекер статистики и привычек.

### 1.4 Основные понятия
- **Запись** — дневниковая запись, ассоциированная с датой, уровнем настроения, описанием и набором активностей.
- **Настроение** — значение от 1 до 5 (эмодзи/шкала).
- **Активность** — категоризация, тег (например: “спорт”, “учёба”), пользователь может создать свои.
- **Подписка** — временный доступ к полному функционалу приложения.
- **Платёж** — транзакция оплаты подписки (в рамках курсача используется мок-обработка).

---

## 2. Функциональные требования

**Краткое описание всех ключевых функций (5-8):**

### 2.1 Регистрация пользователя
- **Описание:** Пользователь вводит логин, пароль и (по желанию) имя. Система проверяет уникальность и корректность, хеширует пароль и сохраняет аккаунт.
- **Входные данные:** логин, пароль, имя.
- **Результат:** новый пользователь создан, перенаправление на форму входа/подписки.

### 2.2 Вход в систему
- **Описание:** Проверка логина/пароля, переход к основному функционалу при наличии активной подписки, либо на экран подписки.
- **Входные данные:** логин, пароль.
- **Результат:** успешный вход (доступ к функциям), неуспешный — сообщение об ошибке.

### 2.3 Оформление подписки, оплата тарифов
- **Описание:** На отдельном экране пользователь выбирает тариф (1 месяц, 6 месяцев, год). После выбора перeходит к форме оплаты (email для чека, карта: номер/MM.YY/CVC). Оплата реализована моково, сохраняется способ оплаты для автопродления.
- **Входные данные:** выбранный тариф, email, реквизиты карты (только цифры).
- **Результат:** при успехе — создаётся/обновляется подписка (в базе), активируется доступ.

### 2.4 Создание, редактирование, удаление записей
- **Описание:** На экране списка можно добавить запись: заполнить дату, заголовок, настроение (от 1 до 5), выбрать или добавить активности, написать подробное описание. Поддерживается редактирование существующих записей и удаление.
- **Входные данные:** все поля и дата.
- **Результат:** запись сохраняется, отображается в списке и влияет на построение статистики.

### 2.5 CRUD активностей
- **Описание:** Пользователь может создать, отредактировать или удалить свои активности в разделе «настройки». Системные активности доступны всем, их удалить нельзя.
- **Входные данные:** название активности.
- **Результат:** активность добавлена/изменена/удалена, можно использовать при создании записей.

### 2.6 Просмотр и анализ статистики
- **Описание:** На отдельной странице пользователь выбирает период (месяц, неделя, год), видит график настроения, диаграмму по уровням, текстовые выводы (KPI, влияние активностей: какие дают прирост настроения, какие — нет).
- **Входные данные:** выбор периода.
- **Результат:** отображается визуализация и статистика на основе реальных записей пользователя.

### 2.7 Смена темы интерфейса
- **Описание:** В настройках реализовано переключение светлой/тёмной темы без перезагрузки приложения.
- **Результат:** меняется визуальный стиль приложения.

---

## 3. Структура базы данных

**Основные таблицы и связи (Entity Framework, SQL Server):**

### 3.1 Users
- **Поля:**
    - Id (Guid, PK)
    - Login (string, уникально, required)
    - Name (string, required)
    - PasswordHash (string, required)
    - CreatedAtUtc (DateTime)
- **Связи:** 1:N с DiaryEntries, 1:N с Subscriptions

### 3.2 DiaryEntries
- **Поля:**
    - Id (Guid, PK)
    - UserId (Guid, FK)
    - Date (DateOnly)
    - Title (string, required)
    - Content (string, required)
    - MoodStatus (int, 1..5)
    - CreatedAtUtc (DateTime)
    - UpdatedAtUtc (DateTime?)
- **Связи:** N:1 с User, N:M с UserActivities

### 3.3 Subscriptions
- **Поля:**
    - Id (Guid, PK)
    - UserId (Guid, FK)
    - Plan (enum/int) — месяц/6м/год
    - PriceRub (int)
    - StartsAtUtc (DateTime)
    - EndsAtUtc (DateTime)
    - Status (enum/int)
- **Связи:** N:1 с User

### 3.4 UserActivities
- **Поля:**
    - Id (Guid, PK)
    - UserId (Guid, FK, nullable — если null, то системная)
    - Name (string, required)
- **Связи:** N:1 c User, N:M с DiaryEntries

### 3.5 DiaryEntryActivities (связующая)
- **Поля:**
    - DiaryEntryId (Guid, PK, FK)
    - UserActivityId (Guid, PK, FK)
- **Связи:** многие-ко-многим DiaryEntries и UserActivities

### 3.6 PaymentMethods
- **Поля:**
    - Id (Guid, PK)
    - UserId (Guid, FK)
    - Provider (string)
    - Token (string)
    - Last4 (string)
    - Brand (string)
    - CreatedAtUtc (DateTime)
    - IsDefault (bool)

---

## 4. Описание форм приложения (WPF)

### 4.1 MainWindow
- **Контейнер:** топбар навигации, content-area
- **Переходы:** стартовая загрузка — окно LoginView

### 4.2 LoginView
- **Элементы:** логин/password, показать-пароль, кнопка входа, кнопка регистрации.
- **Действия:** по успешному входу — EntriesView/или SubscriptionView

### 4.3 RegisterView
- **Элементы:** поля для регистрации, переключатель показать/скрыть пароль, кнопка "создать".
- **Переходы:** по успеху — SubscriptionView

### 4.4 SubscriptionView
- **Элементы:** плитки тарифов, "оплатить"
- **Переходы:** к PaymentView, назад к LoginView

### 4.5 PaymentView
- **Элементы:** отображение стоимости, поля карты/email, кнопка оплаты
- **Переходы:** после оплаты — EntriesView

### 4.6 EntriesView
- **Элементы:** список и календарь записей, фильтры, создать запись
- **Действия:** открыть запись, создать новую, перейти к статистике или редактированию/удалению

### 4.7 AddEntryView/EditEntryView
- **Элементы:** дата, заголовок, настроение (эмодзи), активности (множественный выбор), описание
- **Действия:** сохранить/отмена
- **Переходы:** EntriesView

### 4.8 EntryDetailsView
- **Элементы:** просмотр детальной информации, кнопки редактировать/удалить

### 4.9 StatisticsView
- **Элементы:** график, KPI, pie-chart, инсайт по активностям
- **Действия:** изменение периода

### 4.10 SettingsView
- **Элементы:** список активностей, добавить/редактировать/удалить; смена темы.
- **Действия:** переключение, управление активностями, выход.

---

## 5. Схема переходов между формами (основная навигация)

- **Запуск** → LoginView
- **LoginView**:
   - Успешный вход → EntriesView или SubscriptionView (если нет подписки)
   - Регистрация → RegisterView
- **RegisterView** → SubscriptionView
- **SubscriptionView** → PaymentView/ LoginView
- **PaymentView** → EntriesView
- **EntriesView**:
   - Открыть запись → EntryDetailsView
   - Создать запись → AddEntryView
   - Статистика → StatisticsView
   - Настройки → SettingsView
- **AddEntryView/EditEntryView** → EntriesView
- **StatisticsView/SettingsView** → EntriesView

---

## 6. Нефункциональные требования
- **Технологии:**
    - C#, .NET 8, WPF, EF Core, SQL Server LocalDB
- **Код:**
    - Безопасное хранение паролей, не хранить реквизиты карт.
    - Чистая архитектура, разделение слоёв, DI.
- **UI:**
    - Не блокировать интерфейс долгими операциями (использовать async/await).
- **БД:**
    - Индексация полей UserId, EntryDate, быстрый доступ по периоду.

---

## 7. Критерии приёмки
- Все формы реализованы, переходы работают логично.
- Регистрация, логин, оплата, CRUD записей/активностей работают с БД.
- Графики и статистика строятся на основе реальных записей.
- Есть автопродлении подписки при сохранённом способе.
- Смена темы и работа с активностями осуществляется через UI.

---

## 8. Потенциальные улучшения (по желанию)
- Настоящая интеграция с платёжным сервисом
- Расширенные фильтры статистики (по активности, трендам)
- Более умные инсайты/коучинг
- Веб-версия приложения
- Push-уведомления, напоминания

---

(20.12.2025, Ливитчук Степан Александрович)
